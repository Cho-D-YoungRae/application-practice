# 좋아요 처리하기

## V1

- 구현
  - `좋아요`하면 `좋아요`데이터 저장
  - count, group by 를 통해서 `좋아요` 수 표출 
- 단순히 `좋아요` 수를 표출해야 하는 경우는 특정 게시물의 `좋아요`만 읽기 때문에(개수를 한정됨) 충분할 수 있음
- 데이터가 많아지면 느려짐.
- 캐싱 등으로 해결을 고려해볼 수 있으나, 캐시가 만료되는 시점에 문제가 생기거나 혹은 write-through, write-back 등 복잡한 구성 필요

## V2

- 구현
  - 게시물 메타데이터 테이블 추가
- 메타 데이터 테이블의 `좋아요` 수 칼럼을 통해서 정렬 가능

> `좋아요` 수가 완전한 실시간이여야 할까?  
> `좋아요`는 어디서 실시간이여야 할까? (e.g. `좋아요`을 누르고, 그 즉시 내 `좋아요` 목록에서 보인다)
> `좋아요`수는 반드시 정확한 수로 표출해야 할까? (e.g. 1K 등으로 표출)
> 경합이 발생하는 지점 -> `좋아요` 수 갱신
> `좋아요` 수 정합성이 깨지는 것이 치명적인가? (e.g. 하루에 한번 정합성 체크를 할 수 있음)

## V3

- 구현
  - 비동기로 좋아요 수 갱신
- 정합성 체크 필요

## V4

- 구현
  - 이벤트 처리를 통한 `좋아요` 수 처리
- 정합성 체크 필요
- 이벤트 처리에 대한 관리 필요
  - 트랜잭셔널 메시징 처리(트랜잭셔널 아웃박스 등)을 고려해볼 수 있음
- 좋아요 이벤트 발행을 게시물 아이디별로 파티셔닝 한다면 `좋아요` 수에 대한 경합 처리 필요하지 않을 수 있음

## V5

- 구현
  - 배치를 통한 `좋아요` 수 처리
- `좋아요` 수 갱신이 빠르게 반영되지 않을 수 있음
- `좋아요` 수에 대한 경합 처리 하지 않아도 됨

## 개선 가능 포인트

- `좋아요` 수 정합성 체크 배치를 필요에 따라 최적화 할 수 있음
- `좋아요` 수에 대한 경합 처리를 낙관적 락을 사용하고 있는데 상황에 맞게 비관적 락 혹은 분산 락을 사용할 수 있음

## 보충

- 게시물 테이블이 `좋아요` 수 칼럼을 갖는 것에 대해
  - 게시물의 주 관심사가 `좋아요`에 대한 것은 아닐 수 있음
  - 주 관심사가 아닌 것이 게시물 테이블에 들어가게 되면 추후 계속 관심사가 아닌 것이 추가될 수 있음(e.g. 결제 수, 취소 수, ...)
  - 테이블에 많은 데이터가 있어서 성능적 이슈도 있을 수 있음
  - 특정 상황에서는 이런 구조를 사용해야 할 수도 있음...
- 규모가 크지 않을 때 동시성 문제, count 등을 해결하기 위해 레디스를 빠르게 도입하는 것은 좋지 않을 수 있음
  - 관리 비용 증가
    - storage가 분산됨
    - count가 날라갔을 때 대응
    - redis, rdb count 동기화
- 검색, 페이징 => 검색의 영역일 수 있다
  - 검색은 서비스의 본질과 다르다 -> 분리를 해야한다(시스템적으로 혹은 서비스적으로...)
  - 그렇지 않으면 도메인(개념)이 오염되기 쉬움

## 참고

- [제미니 개발실무: 목록 조회 시 좋아요 수 보여주는 구현 전략](https://www.youtube.com/watch?v=n-7tsMhum4g)
- [제미니 개발실무: 좋아요 수로 정렬+페이징 구현 전략 (feat. 검색 시스템의 진화)](https://youtu.be/h84zzb8FWwo?si=oGWfCnyShdKS9mpO)
